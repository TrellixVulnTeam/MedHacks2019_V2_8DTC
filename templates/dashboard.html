<html>
<head>
  <title>MedHacks 2019</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>
  <div id="dash-header"></div>
  <div id="content">
      <div class="row">
          <div  id="history" class="col-lg-2 col-md-12 sm-12">
              <div class="xray_prev">
                  <h3>9/28/19 - 11:28 AM</h3>
                  <img src="https://via.placeholder.com/150C/" />
              </div>
              <div class="xray_prev">
                  <h3>9/28/19 - 11:28 AM</h3>
                  <img src="https://via.placeholder.com/150C/" />
              </div>
              <div class="xray_prev">
                  <h3>9/28/19 - 11:28 AM</h3>
                  <img src="https://via.placeholder.com/150C/" />
              </div>
              <div class="xray_prev">
                  <h3>9/28/19 - 11:28 AM</h3>
                  <img src="https://via.placeholder.com/150C/" />
              </div>
              <div class="xray_prev">
                  <h3>9/28/19 - 11:28 AM</h3>
                  <img src="https://via.placeholder.com/150C/" />
              </div>
          </div>
          <div class="col-lg-10 col-md-12">
            <h2 id="upload">Add a New XRAY</h2>

            <!--<form action="https://jw9mtag8w6.execute-api.us-east-1.amazonaws.com/prod/"
              class="dropzone"
              id="uploadXray"></form>-->
<script>
  var lastUpload = sessionStorage.getItem("last_upload");
  if (lastUpload.length >0) {
    document.getElementById("imageResultContainer").style.display = "block";
    document.getElementById("resultImg").src('https://elasticbeanstalk-us-east-1-443524287413.s3.amazonaws.com/'+sessionStorage.getItem("last_upload"))
  }
    function getUID() {
      var value = "; " + document.cookie;
      var parts = value.split("; " + "uid" + "=");
      if (parts.length == 2) return parts.pop().split(";").shift();
    }
    var now = new Date();
    var fileKey = getUID() + "_" + now;
    sessionStorage.setItem("last_upload",fileKey+".png");
</script>

<form action="http://elasticbeanstalk-us-east-1-443524287413.s3.amazonaws.com/" method="post" enctype="multipart/form-data">
<input type="hidden" id="fileKeyField" name="key" value="temp.png">
<input type="file" name="file">
<input type="submit">
</form>

              <script>
              document.getElementById("fileKeyField").value = fileKey;
              /*function getDataUri(url, callback) {
                  var image = new Image();

                  image.onload = function () {
                      var canvas = document.createElement('canvas');
                      canvas.width = this.naturalWidth; // or 'width' if you want a special/scaled size
                      canvas.height = this.naturalHeight; // or 'height' if you want a special/scaled size

                      canvas.getContext('2d').drawImage(this, 0, 0);

                      // Get raw image data
                      callback(canvas.toDataURL('image/png').replace(/^data:image\/(png|jpg);base64,/, ''));

                      // ... or get as Data URI
                      callback(canvas.toDataURL('image/png'));
                  };

                  image.src = url;
              }


                $("form").submit(function(e) {
                    e.preventDefault();
                    e.returnValue = false;

                    var userId;
                    var recipientId;

                    // Usage
                    getDataUri('/logo.png', function(dataUri) {
                      // Do whatever you'd like with the Data URI!
                      var imgBase64 = dataUri;
                      console.log(imgBase64);
                    });

                });*/
              </script>
              <div class="row justify-content-lg-center" id="imageResultContainer" style="display: none">
                  <div class="col-lg-6 col-md-12">
                    <h2 id="result">Diagnosis: Acute Bronchitis - Accuracy 92%</h2>
                    <img id="resultImg" src="" />
                  </div>

              </div>


              </div>
          </div>
      </div>
  </div>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="../static/js/dropzone.js"></script>

</body>
</html>
